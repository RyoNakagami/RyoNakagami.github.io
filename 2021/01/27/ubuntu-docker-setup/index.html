<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="gSMaswRY9iRfG4QaQrx6aj481bgr503qEZh-QPsMYNU" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="元経済学徒, 現在どっかでデータサイエンティストもどきやってる人間の勉強日記">
    <meta name="keywords"  content="Statistics, Economics, Econometrics, Python, C, Shell, Linux, Data scientist">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Ubuntu Desktop環境構築 Part 14 - Ryo's Tech Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="
  
    
       
      概要
    
  
  
    
      目的
      Dockerによる環境構築 Part 1: Dockerのインストール
    
    
      参考
      - 初心者のためのコンテナ入門教室:連載第二回- 開発環境、テスト環境、ステージング環境、本番環境について - Docker 概要- Dockerインストール...">
    
    <meta property="article:published_time" content="2021-01-27T00:00:00Z">
    
    
    <meta property="article:author" content="Ryo">
    
    
    <meta property="article:tag" content="Ubuntu 20.04 LTS">
    
    <meta property="article:tag" content="Docker">
    
    
    <meta property="og:image" content="https://ryonakagami.github.io/img/avatar_rio_cat.jpg">
    <meta property="og:url" content="https://ryonakagami.github.io/2021/01/27/ubuntu-docker-setup/">
    <meta property="og:site_name" content="Ryo's Tech Blog">
    
    <title>Ubuntu Desktop環境構築 Part 14 - Ryo's Tech Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://ryonakagami.github.io/2021/01/27/ubuntu-docker-setup/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/ryo-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- https://stackoverflow.com/questions/45983301/google-pagespeed-eliminate-render-blocking-resources-above-the-fold-caused-fro -->
    <!--link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"-->
    <!--<link href="https://fonts.googleapis.com/earlyaccess/notosansjapanese.css" rel="stylesheet" type="text/css" media="print" onload="this.media='all'" > -->
    <link href="https://fonts.googleapis.com/earlyaccess/notosansjapanese.css" rel="preload" type="text/css" media="print" onload="this.media='all'" >


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">
    
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Ryo's Tech Blog</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-left">
                                                <li>
                            <a href="https://ryonakagami.github.io/statistics-for-regression-monkey/">Statistics for
                                Regression Monkeys</a>
                        </li>
                        <li>
                            <a href="https://ohgoshgit.github.io/">OhGoshGit!?!</a>
                        </li>
                        <!-- <li>
                            <a><button onclick="mainDropDown()" style="border-color: rgba(70, 83, 111, 0.989); background-color: rgba(70, 83, 111, 0.989)">Dropdown</button></a> 
                            <div id="myDropdown" class="dropdown-content">
                              <a href="#" onclick="subMenu(this)">A</a>
                              <div class="sub-menu-item" id="subMenu1">
                              <a href="#">A.1</a>
                              </div>
                              <a href="#" onclick="subMenu(this)">B</a>
                              <div class="sub-menu-item" id="subMenu2">
                              <a href="#">B.1</a>
                              </div>
                              <a href="#">C</a>
                              <a href="#">D</a>
                              <a href="#">E</a>
                              <a href="#">F</a>
                              <a href="#">G</a>
                            </div>
                        </li> -->
                    </ul>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        
                        
                        
                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="/archive/">Tag Search</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <!--about fa-search see https://stackoverflow.com/questions/41950677/how-to-make-my-search-icon-fixed-->
                        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
                            rel="stylesheet" />
                        <li class="search-icon">
                            <a href="javascript:void(0)" aria-label="Search" target="_blank">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script>

    <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/home-bg.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/home-bg.jpg');
        background: ;
    }

    
    header.intro-header .header-mask{
        width: 100%;
        height: 100%;
        position: absolute;
        background: rgba(0,0,0, 0.0);
    }
    
</style>




<header class="intro-header style-text" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=Ubuntu+20.04+LTS" title="Ubuntu 20.04 LTS">Ubuntu 20.04 LTS</a>
                        
                        <a class="tag" href="/archive/?tag=Docker" title="Docker">Docker</a>
                        
                    </div>
                    <h1>Ubuntu Desktop環境構築 Part 14</h1>
                    
                    <h2 class="subheading">Dockerによる環境構築 Part 1: Dockerのインストール</h2>
                    <p>
                        公開日: 2021-01-27
                        
                        
                    </p>
                </div>
            </div>
        </div>
    </div>
</header>







<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
         <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<table>
  <thead>
    <tr>
      <th> </th>
      <th>概要</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>目的</td>
      <td>Dockerによる環境構築 Part 1: Dockerのインストール</td>
    </tr>
    <tr>
      <td>参考</td>
      <td>- <a href="https://thinkit.co.jp/article/17301">初心者のためのコンテナ入門教室:連載第二回</a><br />- <a href="https://note.com/gunj/n/nf139710d0e4a">開発環境、テスト環境、ステージング環境、本番環境について </a><br />- <a href="https://matsuand.github.io/docs.docker.jp.onthefly/get-started/overview/">Docker 概要</a><br />- <a href="https://docs.docker.com/engine/install/ubuntu/">Dockerインストール</a><br />- <a href="https://forums.docker.com/t/issues-with-sudo-systemctl-status-docker/98564">Issue with WARNING: No blkio weight support</a><br />- <a href="https://www.youtube.com/watch?v=iqqDU2crIEQ&amp;feature=emb_logo">Docker Tutorial Video</a></td>
    </tr>
  </tbody>
</table>

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

<ul>
  <li><a href="#1-%E4%BB%8A%E5%9B%9E%E3%81%AE%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97">1. 今回のスコープ</a>
    <ul>
      <li><a href="#%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83">実行環境</a></li>
    </ul>
  </li>
  <li><a href="#2-%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%A8%E3%81%AF">2. コンテナとは？</a>
    <ul>
      <li><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E6%A6%82%E8%A6%81">コンテナの概要</a></li>
      <li><a href="#%E3%81%AA%E3%81%9C%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E4%BD%BF%E3%81%86%E3%81%AE%E3%81%8B%E3%83%BB%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AA%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AE%E3%81%8B">なぜコンテナを使うのか・どのようなメリットがあるのか？</a>
        <ul>
          <li><a href="#%E9%96%8B%E7%99%BA%E8%80%85%E7%9B%AE%E7%B7%9A%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%8F%AF%E6%90%AC%E6%80%A7%E3%82%92%E3%81%9F%E3%81%8B%E3%82%81%E3%82%8B">開発者目線：アプリケーションの可搬性をたかめる</a></li>
          <li><a href="#%E8%A8%88%E7%AE%97%E7%A7%91%E5%AD%A6%E7%9B%AE%E7%B7%9A%E5%88%86%E6%9E%90%E7%B5%90%E6%9E%9C%E3%81%AE%E5%86%8D%E7%8F%BE%E5%8F%AF%E8%83%BD%E6%80%A7%E3%82%92%E9%AB%98%E3%82%81%E3%82%8B">計算科学目線：分析結果の再現可能性を高める</a></li>
          <li><a href="#%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88">仮想マシンに対するコンテナのメリット</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#3-%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E6%A7%8B%E9%80%A0">3. コンテナの構造</a>
    <ul>
      <li><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E5%9F%BA%E6%9C%AC%E6%A7%8B%E6%88%90">コンテナの基本構成</a>
        <ul>
          <li><a href="#mac%E3%81%A8windows%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8Bdocker">MacとWindowsにおけるDocker</a></li>
        </ul>
      </li>
      <li><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9">コンテナのプロセス</a>
        <ul>
          <li><a href="#namespace">namespace</a></li>
          <li><a href="#cgroups">cgroups</a></li>
        </ul>
      </li>
      <li><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF">コンテナのネットワーク</a></li>
    </ul>
  </li>
  <li><a href="#4-docker%E3%81%A8%E3%81%AF">4. Dockerとは？</a>
    <ul>
      <li><a href="#docker%E3%81%AE%EF%BC%93%E3%81%A4%E3%81%AE%E3%83%95%E3%82%A7%E3%83%BC%E3%82%BA">Dockerの３つのフェーズ</a></li>
      <li><a href="#docker%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3">Dockerアーキテクチャ</a></li>
      <li><a href="#docker%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%81%A8%E3%81%AF">Dockerイメージとは？</a></li>
    </ul>
  </li>
  <li><a href="#5-ubuntu%E3%81%B8%E3%81%AEdocker%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">5. UbuntuへのDockerのインストール</a>
    <ul>
      <li><a href="#os-requirements">OS requirements</a></li>
      <li><a href="#uninstall-old-versions">Uninstall old versions</a></li>
      <li><a href="#install">Install</a>
        <ul>
          <li><a href="#%E3%83%AC%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%83%BC%E3%81%AE%E8%A8%AD%E5%AE%9A">レポジトリーの設定</a></li>
          <li><a href="#install-docker-engine">Install Docker Engine</a></li>
          <li><a href="#test-hello-world">Test: Hello-world</a></li>
        </ul>
      </li>
      <li><a href="#docker%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%A2%BA%E8%AA%8D">Dockerのバージョン確認</a></li>
      <li><a href="#docker%E3%81%AE%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83%E7%A2%BA%E8%AA%8D">Dockerの実行環境確認</a></li>
      <li><a href="#docker-image%E3%81%AE%E7%A2%BA%E8%AA%8D">Docker imageの確認</a></li>
      <li><a href="#docker%E3%81%AE%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E5%88%A9%E7%94%A8%E7%8A%B6%E6%B3%81-docker-system-df">Dockerのディスク利用状況: <code class="language-plaintext highlighter-rouge">docker system df</code></a></li>
    </ul>
  </li>
  <li><a href="#6-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E5%BE%8C%E3%81%AE%E8%A8%AD%E5%AE%9A">6. インストール後の設定</a>
    <ul>
      <li><a href="#manage-docker-as-a-non-root-user">Manage Docker as a non-root user</a></li>
    </ul>
  </li>
  <li><a href="#7-docker-file%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%8B%E3%82%89docker-image%E3%81%AEbuild%E3%81%BE%E3%81%A7%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB">7. Docker Fileの作成からDocker ImageのBuildまでのチュートリアル</a>
    <ul>
      <li><a href="#dockerfile%E3%81%AE%E6%A7%8B%E6%96%87">Dockerfileの構文</a></li>
      <li><a href="#docker-build%E3%81%AE%E4%BE%8B">Docker buildの例</a></li>
    </ul>
  </li>
  <li><a href="#appendix-%E3%82%B5%E3%83%BC%E3%83%90%E4%BB%AE%E6%83%B3%E5%8C%96%E6%8A%80%E8%A1%93">Appendix: サーバ仮想化技術</a>
    <ul>
      <li><a href="#%E3%83%9B%E3%82%B9%E3%83%88%E5%9E%8B%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E4%BB%AE%E6%83%B3%E5%8C%96">ホスト型サーバー仮想化</a></li>
      <li><a href="#%E3%83%8F%E3%82%A4%E3%83%91%E3%83%BC%E3%83%90%E3%82%A4%E3%82%B6%E3%83%BC%E5%9E%8B%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E4%BB%AE%E6%83%B3%E5%8C%96">ハイパーバイザー型サーバー仮想化</a></li>
    </ul>
  </li>
  <li><a href="#appendix-%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%83%86%E3%82%B9%E3%83%88%E7%92%B0%E5%A2%83%E3%82%B9%E3%83%86%E3%83%BC%E3%82%B8%E3%83%B3%E3%82%B0%E7%92%B0%E5%A2%83%E3%83%97%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E7%92%B0%E5%A2%83%E3%81%AE%E9%81%95%E3%81%84">Appendix: 開発環境、テスト環境、ステージング環境、プロダクション環境の違い</a></li>
  <li><a href="#appendix-%E3%83%91%E3%83%96%E3%83%AA%E3%83%83%E3%82%AFip%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%81%A8%E3%83%97%E3%83%A9%E3%82%A4%E3%83%99%E3%83%BC%E3%83%88ip%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9">Appendix: パブリックIPアドレスとプライベートIPアドレス</a></li>
  <li><a href="#appendix-gpg%E3%82%AD%E3%83%BC">Appendix: GPGキー</a></li>
</ul>

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<h2 id="1-今回のスコープ">1. 今回のスコープ</h2>

<ul>
  <li>Dockerの仕組みの確認</li>
  <li>UbuntuへのDockerのインストール</li>
</ul>

<h3 id="実行環境">実行環境</h3>

<table>
  <thead>
    <tr>
      <th>項目</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>マシン</td>
      <td>HP ENVY TE01-0xxx</td>
    </tr>
    <tr>
      <td>OS</td>
      <td>ubuntu 20.04 LTS Focal Fossa</td>
    </tr>
    <tr>
      <td>CPU</td>
      <td>Intel Core i7-9700 CPU 3.00 GHz</td>
    </tr>
    <tr>
      <td>RAM</td>
      <td>32.0 GB</td>
    </tr>
    <tr>
      <td>GPU</td>
      <td>NVIDIA GeForce RTX 2060 SUPER</td>
    </tr>
  </tbody>
</table>

<h2 id="2-コンテナとは">2. コンテナとは？</h2>

<p>Dockerとは、アプリケーションの実行に必要な環境(ミドルウェアやライブラリやOS/ネットワークといったインフラ環境)を１つのコンテナ(Dockerコンテナ)にまとめ、そのコンテナを用いて、さまざまな環境でアプリケーション実行環境を構築/運用するためのプラットフォームのことです。Docker を使えば、アプリケーションをインフラストラクチャーから切り離すことができるため、ソフトウエアをすばやく提供することができます。 Docker であれば、アプリケーションを管理する手法をそのまま、インフラストラクチャーの管理にも適用できます。 Docker が採用する方法を最大限利用して、アプリケーションの導入、テスト、コードデプロイをすばやく行うことは、つまりコーディングと実稼動の合間を大きく削減できることを意味します。</p>
<h3 id="コンテナの概要">コンテナの概要</h3>

<p>コンテナとは、ホストOS上に論理的な区画(コンテナ)を作り、アプリケーションを動作させるのに必要なライブラリやミドルウェアといったdependenciesを一つのコンテナにパッケージ化し、ホストOS上の独立したアプリケーション実行環境を作成できるようにしたものです。そのため、あたかも個別のサーバーが存在するように動くので、コンテナ技術を使うことで、同じホストOSの上で、バージョンの異なるPythonを同時に動かすこともできます。Virtual BoxやVMwareといった仮想環境構築ソフトと似た働きをしますが、あくまでコンテナはコンテナエンジンというプロセスを通して、ホストOSの「カーネル」を共有することでCPUやメモリなどのリソースを隔離し、仮想的な空間を作り出しています（コンテナ型仮想化といいます）。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker_container.jpg?raw=true" /></p>

<h3 id="なぜコンテナを使うのかどのようなメリットがあるのか">なぜコンテナを使うのか・どのようなメリットがあるのか？</h3>
<h4 id="開発者目線アプリケーションの可搬性をたかめる">開発者目線：アプリケーションの可搬性をたかめる</h4>

<p>アプリケーション開発において、プロダクション環境にできあがったプログラムをデプロイするためには次の要素が必要となります：</p>

<ul>
  <li>アプリケーションの実行ファイル</li>
  <li>ミドルウェアやライブラリ</li>
  <li>OS/ネットワーク/ハードウェア/security patchesといったインフラ環境</li>
</ul>

<p>アプリケーション開発は開発環境・テスト環境・ステージング環境・プロダクション環境とさまざまな環境がありますが、よく直面する問題として「開発環境ではプログラムは動作したが、ステージング/プロダクション環境では動作しない」ことが挙げられます。この問題の要因の一つとして、それぞれの環境においてミドルウェア/ライブラリを含むインフラ環境の構成が開発環境と異なるケースが多いです。コンテナ（特にDocker）は、開発したアプリケーションの実行に必要なインフラ構成要素(dependencies)を一つのコンテナ(Dockerイメージ)にまとめることで、どの環境でも同じコンテナをインストール・稼働させれば、アプリケーションが同じように動作することを可能にしてくれます。一度作ってしまえばどこでも動くソフトウェアの特性のことを可搬性（ポータビリティ）といいます。コンテナを利用すること開発した成果物のポータビリティを高めることができます。</p>

<p>より具体的には、複数のサーバーから構成されるE-commerceサイトのメンテナンスを担当するケースを考えます。E-commerceサイトを運用するとき100台のサーバーを同時に管理しなければならない場面は度々あります。100台のサーバーをメンテナンスするということは100個のOSをそれぞれメンテナンスするということです。セキュリティ対策の一環として、とあるSecurity patchをupgradeしなてはならない場合を考えます。このとき、対象のsecurity patchのdependenciesに注意を払いながらupgradeをする必要がありますが、ただでさえアプリケーションに配慮した上でのOSのメンテナンスは大変ですが100個のサーバーで個別に実施するとなると人員も時間も取られます。OSアップデートとアプリケーションの実行環境をコンテナによって分離できれば、security patch upgrade対応も少し楽になります。</p>

<h4 id="計算科学目線分析結果の再現可能性を高める">計算科学目線：分析結果の再現可能性を高める</h4>

<p>上の開発者目線で紹介したように、コンテナ技術はdependenciesをコンテナイメージに集約し、それをインストール・可動させればどのような環境でもプログラムは同じ動作をしてくれます。計算科学の場合では、分析で活用したプログラミング言語、ライブラリやパッケージをコンテナイメージに集約することで、他人または共著者でも同じコンテナイメージを稼働させてしまえば、同じ分析手法を用いる範囲内で分析結果の再現が容易となります。このように、コンテナを用いることで研究の分析結果の再現性を高めてくれることに繋がります。分析結果の再現性が高まることは、他人が自分の分析手法を理解することを容易にし、コラボレーションの円滑化やレビューの迅速化が期待できます。分析のソースコード渡したけど、正常に動作せず文句言われるというリスクを回避することができます。</p>

<p>また過去の自分が実施した分析結果をしばらく時が経てから再現したい場合でも、分析環境構築がコンテナイメージを稼働させるだけで完了するので、振り返りも容易となります。</p>

<h4 id="仮想マシンに対するコンテナのメリット">仮想マシンに対するコンテナのメリット</h4>

<p>異なる環境を別のマシンで再現することはホスト型サーバー仮想化やハイバーバイザー型仮想化技術と似ているところがあります。しかしコンテナ技術は1つのOSの上で仮想的なユーザー空間であるコンテナを作ることで仮想環境を作る一方、後者の仮想化技術ではホストOSまたはハイパーバイザーの上でゲストOSを立ち上げ、その上に仮想環境をつくります。もう少し簡単にいうと、コンテナ技術はカーネルを共有し、アプリケーションレベルでのみ分離を行っていますが、一般的な仮想マシンでは、OSレベルで環境が分離しています。そのため仮想マシンを立ち上げる(= ゲストOSを立ち上げる)際にOS用にCPU/メモリ/ストレージといったリソースを確保する必要があるのでオーバーヘッドが生じます。また仮想マシンの設定はめんどくさいです。複数の仮想マシンを同時に使うときは、仮想マシンごとにゲストOSが必要なので、設定や管理の負荷が増大するというデメリットもあります。</p>

<p>これに対して、コンテナ技術は以下のようなメリットがあります：</p>

<ul>
  <li>アプリケーションを動作させるために必要な環境が、1つのコンテナで完結し、独立</li>
  <li>簡単にコンテナを作成でき、増えても管理が楽</li>
  <li>ベースOSの機能を共有するため、OSの全機能は必要なく、オーバーヘッドを小さく抑えられる</li>
  <li>新旧バージョンOSやライブラリの違いなど、開発検証環境を多数用意しなくてもいい</li>
  <li>最小限のシステムでOK、ディスクスペースの節約と管理の簡素化</li>
  <li>ベースOSと独立したファイルシステムやデバイスを利用可能</li>
</ul>

<h2 id="3-コンテナの構造">3. コンテナの構造</h2>

<p>上でも説明したように、コンテナはコンテナエンジンというプロセスを通して、ホストOSの「カーネル」を共有することでCPUやメモリなどのリソースを隔離し、仮想的な空間を作り出します。これをコンテナ型仮想化といいます。コンテナでは起動しているホストOSの「カーネル」を共有することでアプリケーションの実行土台を備えることから、コンテナの起動には従来のOSの起動といった工程が必要ないため、ハイパーバイザー型仮想マシンなどで発生するオーバヘッドがありません。</p>

<h3 id="コンテナの基本構成">コンテナの基本構成</h3>

<p>コンテナ型仮想化では、その実行基盤としてハードウェアとOSを共有します。コンテナは単一のホストOS上で動作するコンテナエンジン上にプロセスとして存在し、そのエンジンが管理するシステムリソースの範囲内で、複数のコンテナを同時に動作させることができます。</p>

<p>コンテナの中には、ユーザが動作させたい「アプリケーション」と、そのアプリケーションの実行に必要な「ミドルウェア」、そして「ライブラリ」などが含まれます。このライブラリの中にはOSの基本的なコマンドセットやファイルシステムのライブラリなど、OSが提供する機能の一部が含まれています。OSが提供する機能の一部がコンテナに含まれる理由は、そもそもアプリケーションは、内部でOSの中核であるカーネルの機能を呼び出して動作しているからです。その代表的な例としてファイルの読み書き(I/O)が挙げられます。このようなカーネルに対する呼び出しをシステムコールといい、カーネルがシステムコールを処理することでアプリケーションを動作させています。実際にはABI(Application Binary Interface)と呼ばれる専用のインターフェース経由でやり取りされます。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker-kernel.jpeg?raw=true" /></p>

<p>また、コンテナに必要なライブラリをパッケージとして組み込んでおくことで、ホストOSがUbuntuであったとしてもLinux系であれば別OS(別ディストリビューション)の実行環境をコンテナとして稼働することができます。Linux系と呼ばれるOS群には、RedHat Enterprise Linux(RHEL)やCentOS、Ubuntuなど様々なディストリビューション(各社の配付パッケージ)が存在しますが、基本的に共通のカーネルを使用しているからです。そのため、アプリケーションの実行に必要なライブラリさえあれば、どのディストリビューションでもアプリケーションを動作できる仕様になっています。ただし、例えばRHELで動作するように作成したアプリケーションをUbuntuで動作させようとする場合、動作環境の違い(ファイルシステムやライブラリなど)により正しく動作しません。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker-why-other-distribution-works.jpeg?raw=true" /></p>

<p>OSのコンテナイメージはあくまでもアプリケーションの動作に必要な環境を「それっぽく」再現しているに過ぎません。コンテナの動作に必要なリソースはホストOSからコンテナエンジンを通して間借りしており、コンテナ内のアプリケーションが発行するシステムコールはホストOSで動作しているカーネルが処理します。ハイパーバイザー型仮想化のように個別のOSは存在しないため、コンテナ型仮想化ではLinuxカーネルの互換性に依存します。この点でコンテナ型仮想化はハイパーバイザー型仮想化と異なります。OS固有の機能を含めた動作環境を再現するには、コンテナ型仮想化よりもハイパーバイザー型仮想化を使用する方が良いです。</p>

<h4 id="macとwindowsにおけるdocker">MacとWindowsにおけるDocker</h4>

<p>DockerはLinuxカーネル機能を使うため、通常はLinuxディストリビューション上で動作します。しかし開発環境などで利用するためのクライアントPC向けツールも提供されています。macOS向けのDocker for MacはHypervisorフレームワークであるxhyveの上にDocker実行環境が構築されます。Windowsの場合はハイパーバイザーベースのx64向け仮想システムであるHyper-Vを使っています。</p>

<h3 id="コンテナのプロセス">コンテナのプロセス</h3>

<p>Linux は命令を実行する際に、そのプログラムのソースファイルに書かれた内容を読み込み、メモリ上に展開し、そのメモリに乗ったプログラムを実行していますが、この実行されたプログラムをプロセスと呼びます。コンテナ型仮想化におけるコンテナは、ホストOS上からは1つのプロセスとして扱われるという大きな特徴があります。この仕組みを理解するためにはLinuxカーネル機能のNamespace、Cgroupsを理解する必要があります。</p>

<h4 id="namespace">namespace</h4>

<p>何回も繰り返し説明しているように、コンテナとはホストOS上に論理的な区画(コンテナ)を作り、独立したアプリケーション実行環境を作成できるようにしたものです。このコンテナを区画化する技術はLinuxカーネルのnamespaceという機能で実現されています。namespaceは、まとまったデータに名前をつけて分割することで衝突の可能性を減らし、参照を容易に行う機能です。名前に結び付けられた実体は、その名前がどの名前空間に属するかで一意に定まります。名前空間が異なれば、同じ名前でも別の実体に対応付けることができます。</p>

<p>Linuxカーネルのnamespace機能は次の６つの機能に分類されます。</p>

<table>
  <thead>
    <tr>
      <th>環境</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PID namespace</td>
      <td>PIDとは、各プロセスに割り当てられたユニークなIDのことです。PID namespaceとは、名前空間の異なるプロセス同士は互いにアクセスできなくなる機能です。</td>
    </tr>
    <tr>
      <td>Network namespace</td>
      <td>Network namespaceは、ネットワークデバイス・IPアドレス・ポート番号などのネットワークリソースを隔離された名前空間ごとに独立してもつことを可能にする機能です。生空間が異なっていれば、ホストOS上で使用中のポートがあったとしても、コンテナ内で同じ番号のポートを使用することができます。</td>
    </tr>
    <tr>
      <td>UID namespace</td>
      <td>UID namespaceはUID/GIDを名前空間ごとに独立して設定できる機能です。コンテナ内ではrootユーザーだが、ホストOSでは一般ユーザーという設定が可能となります。</td>
    </tr>
    <tr>
      <td>MOUNT namespace</td>
      <td>名前空間ごとに独立したファイルシステムツリーを作成する機能。</td>
    </tr>
    <tr>
      <td>UTS namespace</td>
      <td>名前空間ごとにホスト名やドメイン名を独自に設定する機能。</td>
    </tr>
    <tr>
      <td>IPC namespace</td>
      <td>プロセス間通信(IPC)オブジェクトを名前空間ごとに独立させる機能。</td>
    </tr>
  </tbody>
</table>

<h4 id="cgroups">cgroups</h4>

<p>Dockerでは、物理マシン上のリソースを複数のコンテナで共有して動作します。cgroupsはプロセスをグループ化し、CPUやメモリなどホストOSの物理的なリソースを分離する役割を担っています。例えば、プロセスが用いるCPUの使用率(e.g. CPU使用率は50%上限)やメモリの割当、デバイスへのアクセスを制御します。1つの特定のプロセスがCPUやメモリリソースを大量に消費することで、ホストOSや他のプロセスに影響が出るといったリスクをコントロールします。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker-cgroups.png?raw=true" /></p>

<h3 id="コンテナのネットワーク">コンテナのネットワーク</h3>

<p>物理サーバには、物理的なNIC(Network Interface Card)が通信の出入り口として機能します。NICには個別のMACアドレスが割り振られており、NICに接続したLANケーブルでサーバ同士をつなげば通信自体は実現できます。ただし、膨大な数のサーバを直接つなぐには限界があります。その限界を突破するにはケーブルを集約する集線装置、つまり「スイッチ」が必要になります。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker-network.jpeg?raw=true" /></p>

<p>コンテナ型仮想化におけるコンテナの通信では、物理サーバの物理NICとNamespaceで分離されたコンテナ内の仮想NICの間にコンテナエンジンで制御されている仮想ブリッジ(Dockerの場合docker0という仮想ブリッジ)があり、コンテナとホストOS間の橋渡しをしています。このdocker0は、Dockerを起動後にデフォルトで作成されます。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker-container-network.jpeg?raw=true" /></p>

<p>Dockerコンテナを起動すると、コンテナに172.17.0.0/16のサブネットマスクを持つプライベートIPアドレスがeth0に自動的に割り当てられます。コンテナのeth0は、ホストOSに作成された仮想NICがペアで割り当てられます。ホストOSのNAPT(Network Address Port Translation)機能により、コンテナのプライベートIPからホストOSが持つIPへ変換されます。これでコンテナは外部と通信できるようになるわけです。簡単にイメージするなら、とあるマンションに住んでいるとして、ホストOSのIPは住所、コンテナのIPはただの部屋番号に過ぎないと解釈できます。</p>

<p>NAPTとは、１つのIPアドレスを複数のコンピューターで共有する技術で、IPアドレスとポート番号を変換する機能です。プライベートIPアドレスと、グローバルIPアドレスを透過的に相互変換する技術で、TCP/UDPのポート番号まで動的に変換されるため、１つのグローバルIPアドレスで複数のマシンから同時に接続することができます。Dockerでは、NAPTにLinuxのiptablesを使っています。Dockerでこの機能を使うときは、コンテナの起動時にコンテナ内で使っているポートを仮想ブリッジdocker0に対して開放します。たとえば、コンテナの起動時にコンテナ内のWebサーバが使用する80番ポートを、ホストOSの8080番ポートに転送するよう設定します。すると、外部のネットワークからホストOSの8080番ポートにアクセスすると、コンテナ内の80番ポートに繋がります。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker-NAPT.png?raw=true" /></p>

<h2 id="4-dockerとは">4. Dockerとは？</h2>

<p>上ではコンテナ技術の概要を紹介しましたが、ここではコンテナの動作に不可欠なコンテナエンジンについて、実質的なデファクトスタンダードのDockerについて紹介します。Dockerの重要な構成要素は「Docker Engine」と「Docker Hub」です。</p>

<ul>
  <li>
    <p>Docker Engineは、アプリケーション本体とそれを実行するための環境を1つのDockerイメージにまとめることができます。そして、移動先でDockerイメージに基づいてコンテナを実行させ、簡単かつ高速にアプリケーションを起動できます。</p>
  </li>
  <li>
    <p>Docker HubはDockerイメージの移動や管理、Dockerイメージを共有する場としての役割を果たします(いわゆるリポジトリ)。Docker Hubの「Automated Build」の機能でGitHubと連携させれば、自動でDockerイメージを作成することもできます。DockerイメージをプライベートレジストリやDockerHubなどへアップロードすることをプッシュといい、逆にダウンロードすることをプルといいます。</p>
  </li>
</ul>

<h3 id="dockerの３つのフェーズ">Dockerの３つのフェーズ</h3>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_docker_works.jpeg?raw=true" /></p>

<table>
  <thead>
    <tr>
      <th>DockerのPhase</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Build Image</code></td>
      <td>アプリケーションが必要とするdependenciesをconsistentlyにパッケージ化するフェーズ</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Ship Image</code></td>
      <td>Build Phaseで作成されたイメージを実行環境に移植するフェーズ</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Run Image</code></td>
      <td>Imageを実行して、アプリケーション実行環境を作成するフェーズ</td>
    </tr>
  </tbody>
</table>

<h3 id="dockerアーキテクチャ">Dockerアーキテクチャ</h3>

<p>Docker はクライアントサーバー型のアーキテクチャーを採用しています。 Docker クライアント は Docker デーモンに処理を依頼します。 このデーモンは、Docker コンテナーの構築、実行、配布という複雑な仕事をこなします。 Docker クライアントとデーモンは同一システム上で動かすことも 可能 ですが、別のシステム上であっても、Docker クライアントからリモートにある Docker デーモンへのアクセスが可能です。 Docker クライアントとデーモンの間の通信には REST API が利用され、UNIX ソケットまたはネットワークインターフェイスを介して行われます。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker_architecture.png?raw=true" /></p>

<table>
  <thead>
    <tr>
      <th>項目</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Docker デーモン</td>
      <td>Docker デーモン（dockerd）は Docker API リクエストを受け付け、イメージ、コンテナー、ネットワーク、ボリュームといった Docker オブジェクトを管理します。 また Docker サービスを管理するため、他のデーモンとも通信を行います。</td>
    </tr>
    <tr>
      <td>REST API</td>
      <td>プログラムとデーモンとの間での通信方法を定義し、何をなすべきかを指示する。</td>
    </tr>
    <tr>
      <td>Docker クライアント</td>
      <td>Docker クライアント（docker）は Docker とのやりとりを行うために、たいていのユーザーが利用するものです。 docker run のようなコマンドが実行されると、Docker クライアントは dockerd にそのコマンドを伝えます。 そして dockerd はその内容を実現します。 docker コマンドは Docker API を利用しています。 Docker クライアントは複数のデーモンと通信することができます。</td>
    </tr>
    <tr>
      <td>Docker オブジェクト</td>
      <td>イメージ、コンテナー、ネットワーク、データボリュームなどです。</td>
    </tr>
  </tbody>
</table>

<h3 id="dockerイメージとは">Dockerイメージとは？</h3>

<p>Dockerイメージとは、Dockerコンテナーを作成する命令が入った読み込み専用のテンプレートです。 イメージは作ろうと思えば作ることができ、他の方が作ってレジストリに公開されているイメージを使うということもできます。 イメージを自分で作る場合は Dockerfile というファイルを生成します。DockerfileはDocker Imageにブループリントみたいなものです。このファイルの文法は単純なものであり、そこにはイメージを生成して実行するまでの手順が定義されます。アプリケーションが動作する土台となるインフラ環境を構築するコマンドや手順などを所定の書き方でDockerfileに記載すれば、その作業は全部Dockerが自動でやってくれます。 Dockerfileからベースイメージを使用してDockerイメージを作成することをビルドといいます。また、既に起動されたDockerコンテナからイメージを作成することをコミットと呼びます。</p>

<p>DockerイメージはUFS(Union File System)という、複数のファイルやディレクトリをレイヤ(層)として積み重ねて、仮想的に1つのファイルシステムとして扱う技術を用いています。Dockerfile 内の個々の命令ごとに、イメージ内にはレイヤーというものが生成されます。 Dockerfile の内容を書き換えたことでイメージが再構築されるときには、変更がかかったレイヤーのみが再生成されます。これをコピーオンライトと呼びます。 他の仮想化技術に比べて Dockerイメージというものが軽量、小さい、早いを実現できているのも、そういった部分があるからです。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker_layer.jpeg?raw=true" /></p>

<p>さらにもう一つの特徴として、同一のホスト上で動く複数のコンテナがある場合は、イメージレイヤを共有できます。これにより、ホストのストレージ容量の圧迫を抑制できるようになります。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker_share_layer.jpeg?raw=true" /></p>

<h2 id="5-ubuntuへのdockerのインストール">5. UbuntuへのDockerのインストール</h2>

<p>Docker は コミュニティ版（CE; Community Edition） と エンタープライズ版（EE; Enterprise Edition） の２つのエディションがあります。今回はCE版のインストール方法を紹介します。</p>

<h3 id="os-requirements">OS requirements</h3>

<p>Docker Engineは<code class="language-plaintext highlighter-rouge">x86_64</code>(or <code class="language-plaintext highlighter-rouge">amd64</code>), <code class="language-plaintext highlighter-rouge">armhf</code>, <code class="language-plaintext highlighter-rouge">arm64</code> architecturesでサポートされています。サポートされているUbuntuのversionは以下、</p>

<ul>
  <li>Ubuntu Groovy 20.10</li>
  <li>Ubuntu Focal 20.04 (LTS)</li>
  <li>Ubuntu Bionic 18.04 (LTS)</li>
  <li>Ubuntu Xenial 16.04 (LTS)</li>
</ul>

<p>今回は、<code class="language-plaintext highlighter-rouge">x86_64</code>アーキテクチャでのインストール方法を紹介します。</p>

<h3 id="uninstall-old-versions">Uninstall old versions</h3>

<p>古いversionのdockerがインストールされている場合があるので一旦アンインストールします。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>% sudo apt-get remove docker docker-engine docker.io containerd runc
</pre></td></tr></tbody></table></code></pre></div></div>

<p>images, containers, volumes, and networksといったdockerオブジェクトは<code class="language-plaintext highlighter-rouge">/var/lib/docker/</code>に保存されていますが、上記のコマンドを実行してもこれらdockerオブジェクトは削除されません。これらを削除したい場合は<code class="language-plaintext highlighter-rouge">sudo rm -rf /var/lib/docker</code>を実行します。</p>

<h3 id="install">Install</h3>

<p>手順としては</p>

<ol>
  <li>Docker repositoryの登録</li>
  <li>Docker Engineのインストール</li>
</ol>

<p>となります。</p>

<h4 id="レポジトリーの設定">レポジトリーの設定</h4>

<p>まずいつもどおりにpackage indexのupdateを実施します</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>% sudo apt update
</pre></td></tr></tbody></table></code></pre></div></div>

<p>次にSetupに必要なpackageのインストールをします（HTTPS経由でレポジトリを使用できるようにするため）。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>% sudo apt install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common
</pre></td></tr></tbody></table></code></pre></div></div>

<p>次にDockerの公式GPGキーを追加します。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>% curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Dockerの公式GPGキーが追加されているかどうか確認します。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>% sudo apt-key fingerprint 0EBFCD88                                                                                                                                                                          ?master[sudo] password for ryo_nak: 
pub   rsa4096 2017-02-22 [SCEA]
      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
uid           [ unknown] Docker Release (CE deb) &lt;docker@docker.com&gt;
sub   rsa4096 2017-02-22 [S]
</pre></td></tr></tbody></table></code></pre></div></div>

<p>最後にDockerのレポジトリを登録します。今回は<code class="language-plaintext highlighter-rouge">stable</code>版を登録します。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>% sudo add-apt-repository \                                 
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="install-docker-engine">Install Docker Engine</h4>

<p>Docker EngineとcontainerdとCLIをインストールします。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>% sudo apt install docker-ce docker-ce-cli containerd.io
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="test-hello-world">Test: Hello-world</h4>

<p>インストールしたDockerが正しく動作するか確認テストします。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>% sudo docker run hello-world

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="dockerのバージョン確認">Dockerのバージョン確認</h3>

<p>インストールしたDockerのバージョンを確認するには、<code class="language-plaintext highlighter-rouge">docker version</code>コマンドを使います。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre>% docker version
Client: Docker Engine - Community
 Version:           20.10.2
 API version:       1.41
 Go version:        go1.13.15
 Git commit:        2291f61
 Built:             Mon Dec 25 16:17:43 2020
 OS/Arch:           linux/amd64
 Context:           default
 Experimental:      true

Server: Docker Engine - Community
 Engine:
  Version:          20.10.2
  API version:      1.41 (minimum version 1.12)
  Go version:       go1.13.15
  Git commit:       8891c58
  Built:            Mon Dec 25 16:15:19 2020
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          1.4.3
  GitCommit:        269548fa27e0089a8b8278fc4fc781d7f65a939b
 runc:
  Version:          1.0.0-rc92
  GitCommit:        ff819c7e9184c13b7c2607fe6c30ae19403a7aff
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="dockerの実行環境確認">Dockerの実行環境確認</h3>

<p><code class="language-plaintext highlighter-rouge">docker system info</code>コマンドを実行すると、Dockerの実行環境の詳細設定が表示されます。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="rouge-code"><pre>% docker system info
Client:
 Context:    default
 Debug Mode: false
 Plugins:
  app: Docker App (Docker Inc., v0.9.1-beta3)
  buildx: Build with BuildKit (Docker Inc., v0.5.1-docker)

Server:
 Containers: 3 #コンテナの数
  Running: 0
  Paused: 0
  Stopped: 3
 Images: 40
 Server Version: 20.10.2  # Dockerのバージョン
 Storage Driver: overlay2 # ストレージドライバーの種類
  Backing Filesystem: extfs
  Supports d_type: true
  Native Overlay Diff: true
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Cgroup Version: 1
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
 Swarm: inactive
 Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: 269548fa27e0089a8b8278fc4fc781d7f65a939b
 runc version: ff819c7e9184c13b7c2607fe6c30ae19403a7aff
 init version: de40ad0
 Security Options:
  apparmor
  seccomp
   Profile: default
 Kernel Version: 5.8.0-41-generic
 Operating System: Ubuntu 20.04.1 LTS
 OSType: linux
 Architecture: x86_64
 CPUs: 8
 Total Memory: 31.24GiB
 Name: &lt;user name&gt;
 ID: &lt;ID&gt;
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 Registry: https://index.docker.io/v1/
 Labels:
 Experimental: false
 Insecure Registries:
  127.0.0.0/8
 Live Restore Enabled: false
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="docker-imageの確認">Docker imageの確認</h3>

<p><code class="language-plaintext highlighter-rouge">docker image ls</code>(または<code class="language-plaintext highlighter-rouge">docker images</code>)でイメージの確認が実施できます。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>% docker image ls
REPOSITORY   TAG       IMAGE ID       CREATED         SIZE
example      latest    2345asdasd22   5 days ago      2.5GB
(略)
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="dockerのディスク利用状況-docker-system-df">Dockerのディスク利用状況: <code class="language-plaintext highlighter-rouge">docker system df</code></h3>

<p><code class="language-plaintext highlighter-rouge">docker system df</code>コマンドはDockerが使用しているディスクの利用状況が表示されます。</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>% docker system <span class="nb">df
</span>TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE
Images          10        2         6.757GB   5.487GB <span class="o">(</span>81%<span class="o">)</span>
Containers      5         0         70.29MB   70.29MB <span class="o">(</span>100%<span class="o">)</span>
Local Volumes   1         0         258.6MB   258.6MB <span class="o">(</span>100%<span class="o">)</span>
Build Cache     0         0         0B        0B
</pre></td></tr></tbody></table></code></pre></div></div>

<p>詳細を表示したい場合は<code class="language-plaintext highlighter-rouge">-v</code> optionを追加します。</p>

<h2 id="6-インストール後の設定">6. インストール後の設定</h2>
<h3 id="manage-docker-as-a-non-root-user">Manage Docker as a non-root user</h3>

<p>The Docker daemonはTCP portではなく Unix socketにバインドされています。デフォルトではUnix socketは<code class="language-plaintext highlighter-rouge">root</code> userの管理下となっており、他のユーザーは<code class="language-plaintext highlighter-rouge">sudo</code>コマンドを用いてアクセスする必要があります。そのためデフォルトでは、Dockerを起動するとき<code class="language-plaintext highlighter-rouge">sudo</code>コマンドを用いる必要がありますが、今回はその設定を変更し、自分が指定したユーザーならば<code class="language-plaintext highlighter-rouge">sudo</code>コマンドを用いなくてもDockerを起動できるように変更します。</p>

<p>まず、<code class="language-plaintext highlighter-rouge">docker</code> groupを作成します。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>% sudo groupadd docker
</pre></td></tr></tbody></table></code></pre></div></div>

<p>自分が指定するユーザーを<code class="language-plaintext highlighter-rouge">docker</code> groupに加えます（current userを今回は加えます）</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>% sudo usermod -aG docker $USER
</pre></td></tr></tbody></table></code></pre></div></div>

<p>次にdocker groupの変更を反映します。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>% newgrp docker
</pre></td></tr></tbody></table></code></pre></div></div>

<p>最後にhello-worldのテストをします。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre>% docker run hello-world

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="7-docker-fileの作成からdocker-imageのbuildまでのチュートリアル">7. Docker Fileの作成からDocker ImageのBuildまでのチュートリアル</h2>

<p>こちらの<a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">記事</a>を参考にしています。</p>

<h3 id="dockerfileの構文">Dockerfileの構文</h3>

<p>Dockerfileに記載された指示にしたがってDockerはコンテナを作ります。</p>

<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> ubuntu:18.04</span>
<span class="k">COPY</span><span class="s"> . /app</span>
<span class="k">RUN </span>make /app
<span class="k">CMD</span><span class="s"> python /app/app.py</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>指示</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">FROM</code></td>
      <td>ベースレイヤーを定義しています。今回は<code class="language-plaintext highlighter-rouge">ubuntu:18.04</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">COPY</code></td>
      <td><code class="language-plaintext highlighter-rouge">COPY</code> 命令は <code class="language-plaintext highlighter-rouge">&lt;src&gt;</code> からファイルやディレクトリを新たにコピーして、コンテナ内のファイルシステムのパス <code class="language-plaintext highlighter-rouge">&lt;dest&gt;</code> に追加します。今回はDocker Client側のカレントディレクトリすべてのファイルを<code class="language-plaintext highlighter-rouge">/app</code>に追加しています。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">RUN</code></td>
      <td><code class="language-plaintext highlighter-rouge">RUN</code> 命令は、現在のイメージの最上位の最新レイヤーにおいて、あらゆるコマンドを実行します。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CMD</code></td>
      <td><code class="language-plaintext highlighter-rouge">CMD</code>命令はコンテナイメージを実行する時、自動的に実行するコマンドを指定しています。</td>
    </tr>
  </tbody>
</table>

<h3 id="docker-buildの例">Docker buildの例</h3>

<p>tagで<code class="language-plaintext highlighter-rouge">helloapp:v1</code>と名付けたイメージを作成します。なお、<code class="language-plaintext highlighter-rouge">Docker build -h</code>で確認するとTagオプションの使用方法は以下。</p>

<pre><code class="language-raw"> -t, --tag list                Name and optionally a tag in the 'name:tag' format
</code></pre>

<p>Docker fileの作成とbuildを実行します。</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nb">mkdir </span>myproject <span class="o">&amp;&amp;</span> <span class="nb">cd </span>myproject
<span class="nb">echo</span> <span class="s2">"hello"</span> <span class="o">&gt;</span> hello
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"FROM busybox</span><span class="se">\n</span><span class="s2">COPY /hello /</span><span class="se">\n</span><span class="s2">RUN cat /hello"</span> <span class="o">&gt;</span> Dockerfile
docker build <span class="nt">-t</span> helloapp:v1 <span class="nb">.</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>実行後、作成されたDocker imageを確認します。</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>% docker images
REPOSITORY                                                        TAG       IMAGE ID       CREATED          SIZE
helloapp                                                          v1        eab00ecb1bfb   11 seconds ago   1.23MB
</pre></td></tr></tbody></table></code></pre></div></div>

<p>次にこのDOcker imageを削除します。基本的には<code class="language-plaintext highlighter-rouge">docker rmi &lt;image ID&gt;</code>となります。</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>% docker rmi eab00ecb1bfb
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="appendix-サーバ仮想化技術">Appendix: サーバ仮想化技術</h2>
<h3 id="ホスト型サーバー仮想化">ホスト型サーバー仮想化</h3>

<p>仮想化ソフトが既存のオペレーティングシステム（ホストOS）上にアプリケーションの一つとしてインストールされ、この中で追加のオペレーティングシステム（ゲストOS）を実行することで仮想環境を作る仕組みです。Oracle VM VirtualBoxが有名どころです。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker_host-vm.png?raw=true" /></p>

<h3 id="ハイパーバイザー型サーバー仮想化">ハイパーバイザー型サーバー仮想化</h3>

<p>ハイパーバイザがハードウェア上で直接動作 (=ベアメタル実装)し、全てのOS（ゲストOS）はそのハイパーバイザ上で動作する方式のことです。Xen, VMwareの ESX、ESXi、vSphere, L4マイクロカーネルファミリー, TRANGO, マイクロソフトのHyper-V, LinuxのKernel-based Virtual Machine (KVM), SELTECHのFOXvisorが有名どころ。</p>

<p><img src="https://github.com/ryonakimageserver/omorikaizuka/blob/master/%E3%83%96%E3%83%AD%E3%82%B0%E7%94%A8/20210127_ubuntu_docker_hypervisor-vm.png?raw=true" /></p>

<h2 id="appendix-開発環境テスト環境ステージング環境プロダクション環境の違い">Appendix: 開発環境、テスト環境、ステージング環境、プロダクション環境の違い</h2>

<table>
  <thead>
    <tr>
      <th>環境</th>
      <th>説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>開発環境</td>
      <td>開発環境とは開発者（プログラマー）がアプリケーションのプログラム本体を開発するために利用する環境のことです。環境の用意と管理は開発者側で行います。</td>
    </tr>
    <tr>
      <td>テスト環境</td>
      <td>できあがったプログラムの動作を検証する環境です。秘匿性の高い情報を扱う場合もあるので環境の用意と管理はクライアント側で行うのが望ましいと思いますが、状況により制作会社側で行うこともあります。<br /><br />誤記やリンクミス、動作に不具合が無いかを検証・修正します。</td>
    </tr>
    <tr>
      <td>ステージング環境</td>
      <td>プロダクション環境とほぼ同じ環境になります。同じ環境とは、リバース プロキシ、SSL 設定、またはロードバランサなどを含めてプロダクション環境と同じ構成にし、プロダクション環境をほぼ複製したものになります。アップするファイルもプロダクション環境と同じものだけです。テスト環境でOKが出たものをデプロイ（UP + 実行）し、動作や不具合が無いかを最終チェックします。テスト環境とはサーバ構成が異なるため、テスト環境では問題が無くてもステージング環境では問題が出る場合があり、ステージングで問題が出るということは本番でも同じ問題が出る可能性が限りなく高いということになります。<br /><br /> 動作や表示など閲覧するのに問題が無いかが焦点になります。</td>
    </tr>
    <tr>
      <td>プロダクション環境</td>
      <td>アプリケーションが製品としてデプロイされ、運用担当や実際のユーザ（顧客）がシステムを利用する実稼働環境。ステージングでテスト（レビュー）が完了した機能・特徴が提供されます。</td>
    </tr>
  </tbody>
</table>

<h2 id="appendix-パブリックipアドレスとプライベートipアドレス">Appendix: パブリックIPアドレスとプライベートIPアドレス</h2>

<p>インターネットで使わているTCP/IPというプロトコルでは、通信先を特定するのにIPアドレスを用います。IPアドレスは、ネットワーク上で互いに重複しないユニークな番号で、いわゆる住所に相当します。住所に相当する方のIPアドレスはパブリックIPアドレスと言われ、各ユーザーは自由に設定することができません。一方、自由に使えるIPアドレスはプライベートIPアドレスといいます。IPv4におけるプライベートIPアドレスの範囲は定義されており、以下のようになります。</p>

<table>
  <thead>
    <tr>
      <th>IPアドレス範囲</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">10.0.0.0</code>~<code class="language-plaintext highlighter-rouge">10.255.255.255</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">172.16.0.0</code>~<code class="language-plaintext highlighter-rouge">172.31.255.255</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">192.168.0.0</code>~<code class="language-plaintext highlighter-rouge">192.168.255.255</code></td>
    </tr>
  </tbody>
</table>

<h2 id="appendix-gpgキー">Appendix: GPGキー</h2>

<p>GPGキーとは「GnuPG」（GNU Privacy Guard）という暗号化ソフトで生成される公開鍵です。Linuxの場合，apt-getコマンドやyumコマンドを使ってインターネットから入手できるパッケージが正しい配布先のものかどうかのチェックなどに利用しています。</p>


                <hr style="visibility: hidden;">
                <hr/>
                <b><fontsize="5">Share Buttons</font><br></b>
                <!--see 
    https://jekyllcodex.org/without-plugin/share-buttons/ 
    https://ranvir.xyz/blog/why-and-how-to-add-social-sharing-buttons-on-your-jekyll-blog-using-github-pages/
-->



<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
    position: relative;
    text-align: left; 
    height: 36px; 
    width: 32px; 
    float: left; 
    text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<span style="color: black">Share on: </span><div id="share-buttons">
    <div class="facebook" title="Share this on Facebook" onclick="gtag('event', 'Facebook', {'event_category':'Post Shared','event_label':'Facebook'}); location.href='http://www.facebook.com/share.php?u=https://ryonakagami.github.io/2021/01/27/ubuntu-docker-setup/';"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
    <div class="twitter" title="Share this on Twitter" onclick="gtag('event', 'Twitter', {'event_category':'Post Shared','event_label':'Twitter'}); location.href='https://twitter.com/intent/tweet?text=Ubuntu Desktop環境構築 Part 14&url=https://ryonakagami.github.io/2021/01/27/ubuntu-docker-setup/';"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
    <div class="linkedin" title="Share this on Linkedin" onclick="gtag('event', 'Linkedin', {'event_category':'Post Shared','event_label':'Linkedin'}); location.href='https://www.linkedin.com/shareArticle?mini=true&url=https://ryonakagami.github.io/2021/01/27/ubuntu-docker-setup/&title=&summary=&source=';"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
    
    <div class="mail" title="Share this through Email" onclick="gtag('event', 'Email', {'event_category':'Post Shared','event_label':'Email'}); location.href='mailto:?&body=https://ryonakagami.github.io/2021/01/27/ubuntu-docker-setup/';"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div>

                
                <hr/>

                <!-- Featured Tags -->
                <b><fontsize="5">Feature Tags</b>
                    <div id="tag_cloud" class="tags tags-sup js-tags" 
                    style="line-height: 0px !important;">
                        
                        
                        
                        
                        
                                <a data-sort="0288" 
                                    href="/archive/?tag=%E7%B5%B1%E8%A8%88"
                                    title="統計"
                                    style="color: #337ab7 !important;"
                                    rel="61">統計</a>
                        
                                <a data-sort="0298" 
                                    href="/archive/?tag=Python"
                                    title="Python"
                                    style="color: #337ab7 !important;"
                                    rel="51">Python</a>
                        
                                <a data-sort="0300" 
                                    href="/archive/?tag=math"
                                    title="math"
                                    style="color: #337ab7 !important;"
                                    rel="49">math</a>
                        
                                <a data-sort="0303" 
                                    href="/archive/?tag=Linux"
                                    title="Linux"
                                    style="color: #337ab7 !important;"
                                    rel="46">Linux</a>
                        
                                <a data-sort="0316" 
                                    href="/archive/?tag=Ubuntu+20.04+LTS"
                                    title="Ubuntu 20.04 LTS"
                                    style="color: #337ab7 !important;"
                                    rel="33">Ubuntu 20.04 LTS</a>
                        
                                <a data-sort="0319" 
                                    href="/archive/?tag=Shell"
                                    title="Shell"
                                    style="color: #337ab7 !important;"
                                    rel="30">Shell</a>
                        
                                <a data-sort="0321" 
                                    href="/archive/?tag=English"
                                    title="English"
                                    style="color: #337ab7 !important;"
                                    rel="28">English</a>
                        
                                <a data-sort="0324" 
                                    href="/archive/?tag=git"
                                    title="git"
                                    style="color: #337ab7 !important;"
                                    rel="25">git</a>
                        
                                <a data-sort="0329" 
                                    href="/archive/?tag=%E6%96%B9%E6%B3%95%E8%AB%96"
                                    title="方法論"
                                    style="color: #337ab7 !important;"
                                    rel="20">方法論</a>
                        
                                <a data-sort="0333" 
                                    href="/archive/?tag=Ubuntu+22.04+LTS"
                                    title="Ubuntu 22.04 LTS"
                                    style="color: #337ab7 !important;"
                                    rel="16">Ubuntu 22.04 LTS</a>
                        
                                <a data-sort="0337" 
                                    href="/archive/?tag=%E7%B5%B1%E8%A8%88%E6%A4%9C%E5%AE%9A"
                                    title="統計検定"
                                    style="color: #337ab7 !important;"
                                    rel="12">統計検定</a>
                        
                                <a data-sort="0338" 
                                    href="/archive/?tag=%E7%AB%B6%E6%8A%80%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0"
                                    title="競技プログラミング"
                                    style="color: #337ab7 !important;"
                                    rel="11">競技プログラミング</a>
                        
                                <a data-sort="0339" 
                                    href="/archive/?tag=%E3%83%95%E3%83%BC%E3%83%AA%E3%82%A8%E8%A7%A3%E6%9E%90"
                                    title="フーリエ解析"
                                    style="color: #337ab7 !important;"
                                    rel="10">フーリエ解析</a>
                        
                                <a data-sort="0340" 
                                    href="/archive/?tag=%E5%89%8D%E5%87%A6%E7%90%86"
                                    title="前処理"
                                    style="color: #337ab7 !important;"
                                    rel="9">前処理</a>
                        
                                <a data-sort="0340" 
                                    href="/archive/?tag=SQL"
                                    title="SQL"
                                    style="color: #337ab7 !important;"
                                    rel="9">SQL</a>
                        
                                <a data-sort="0340" 
                                    href="/archive/?tag=coding"
                                    title="coding"
                                    style="color: #337ab7 !important;"
                                    rel="9">coding</a>
                        
                                <a data-sort="0341" 
                                    href="/archive/?tag=%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"
                                    title="コミュニケーション"
                                    style="color: #337ab7 !important;"
                                    rel="8">コミュニケーション</a>
                        
                                <a data-sort="0342" 
                                    href="/archive/?tag=Network"
                                    title="Network"
                                    style="color: #337ab7 !important;"
                                    rel="7">Network</a>
                        
                                <a data-sort="0342" 
                                    href="/archive/?tag=ssh"
                                    title="ssh"
                                    style="color: #337ab7 !important;"
                                    rel="7">ssh</a>
                        
                                <a data-sort="0343" 
                                    href="/archive/?tag=%E5%B0%86%E6%A3%8B"
                                    title="将棋"
                                    style="color: #337ab7 !important;"
                                    rel="6">将棋</a>
                        
                                <a data-sort="0343" 
                                    href="/archive/?tag=Data+visualization"
                                    title="Data visualization"
                                    style="color: #337ab7 !important;"
                                    rel="6">Data visualization</a>
                        
                                <a data-sort="0343" 
                                    href="/archive/?tag=Docker"
                                    title="Docker"
                                    style="color: #337ab7 !important;"
                                    rel="6">Docker</a>
                        
                                <a data-sort="0343" 
                                    href="/archive/?tag=Econometrics"
                                    title="Econometrics"
                                    style="color: #337ab7 !important;"
                                    rel="6">Econometrics</a>
                        
                                <a data-sort="0343" 
                                    href="/archive/?tag=VSCode"
                                    title="VSCode"
                                    style="color: #337ab7 !important;"
                                    rel="6">VSCode</a>
                        
                                <a data-sort="0343" 
                                    href="/archive/?tag=statistical+inference"
                                    title="statistical inference"
                                    style="color: #337ab7 !important;"
                                    rel="6">statistical inference</a>
                        
                                <a data-sort="0344" 
                                    href="/archive/?tag=GitHub+Pages"
                                    title="GitHub Pages"
                                    style="color: #337ab7 !important;"
                                    rel="5">GitHub Pages</a>
                        
                                <a data-sort="0344" 
                                    href="/archive/?tag=apt"
                                    title="apt"
                                    style="color: #337ab7 !important;"
                                    rel="5">apt</a>
                        
                                <a data-sort="0344" 
                                    href="/archive/?tag=development"
                                    title="development"
                                    style="color: #337ab7 !important;"
                                    rel="5">development</a>
                        
                                <a data-sort="0345" 
                                    href="/archive/?tag=%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E7%AE%A1%E7%90%86"
                                    title="システム管理"
                                    style="color: #337ab7 !important;"
                                    rel="4">システム管理</a>
                        
                                <a data-sort="0345" 
                                    href="/archive/?tag=Coffee"
                                    title="Coffee"
                                    style="color: #337ab7 !important;"
                                    rel="4">Coffee</a>
                        
                                <a data-sort="0345" 
                                    href="/archive/?tag=cloud"
                                    title="cloud"
                                    style="color: #337ab7 !important;"
                                    rel="4">cloud</a>
                        
                                <a data-sort="0346" 
                                    href="/archive/?tag=%E6%95%B0%E5%80%A4%E8%A8%88%E7%AE%97"
                                    title="数値計算"
                                    style="color: #337ab7 !important;"
                                    rel="3">数値計算</a>
                        
                                <a data-sort="0346" 
                                    href="/archive/?tag=%E7%B4%A0%E6%95%B0"
                                    title="素数"
                                    style="color: #337ab7 !important;"
                                    rel="3">素数</a>
                        
                                <a data-sort="0346" 
                                    href="/archive/?tag=Book"
                                    title="Book"
                                    style="color: #337ab7 !important;"
                                    rel="3">Book</a>
                        
                                <a data-sort="0346" 
                                    href="/archive/?tag=Font"
                                    title="Font"
                                    style="color: #337ab7 !important;"
                                    rel="3">Font</a>
                        
                                <a data-sort="0346" 
                                    href="/archive/?tag=Metrics"
                                    title="Metrics"
                                    style="color: #337ab7 !important;"
                                    rel="3">Metrics</a>
                        
                                <a data-sort="0346" 
                                    href="/archive/?tag=Poetry"
                                    title="Poetry"
                                    style="color: #337ab7 !important;"
                                    rel="3">Poetry</a>
                        
                                <a data-sort="0346" 
                                    href="/archive/?tag=Ubuntu+24.04+LTS"
                                    title="Ubuntu 24.04 LTS"
                                    style="color: #337ab7 !important;"
                                    rel="3">Ubuntu 24.04 LTS</a>
                        
                                <a data-sort="0346" 
                                    href="/archive/?tag=architecture"
                                    title="architecture"
                                    style="color: #337ab7 !important;"
                                    rel="3">architecture</a>
                        
                                <a data-sort="0346" 
                                    href="/archive/?tag=aws"
                                    title="aws"
                                    style="color: #337ab7 !important;"
                                    rel="3">aws</a>
                        
                                <a data-sort="0346" 
                                    href="/archive/?tag=shell"
                                    title="shell"
                                    style="color: #337ab7 !important;"
                                    rel="3">shell</a>
                        
                                <a data-sort="0346" 
                                    href="/archive/?tag=systemctl"
                                    title="systemctl"
                                    style="color: #337ab7 !important;"
                                    rel="3">systemctl</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88"
                                    title="テンプレート"
                                    style="color: #337ab7 !important;"
                                    rel="2">テンプレート</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0"
                                    title="データ構造"
                                    style="color: #337ab7 !important;"
                                    rel="2">データ構造</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=%E3%83%9D%E3%83%AF%E3%82%BD%E3%83%B3%E5%88%86%E5%B8%83"
                                    title="ポワソン分布"
                                    style="color: #337ab7 !important;"
                                    rel="2">ポワソン分布</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=%E4%BC%9A%E8%A8%88%E5%88%86%E6%9E%90"
                                    title="会計分析"
                                    style="color: #337ab7 !important;"
                                    rel="2">会計分析</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=%E6%96%87%E5%AD%97%E3%82%B3%E3%83%BC%E3%83%89"
                                    title="文字コード"
                                    style="color: #337ab7 !important;"
                                    rel="2">文字コード</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89"
                                    title="環境構築"
                                    style="color: #337ab7 !important;"
                                    rel="2">環境構築</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=%E8%AB%96%E6%96%87"
                                    title="論文"
                                    style="color: #337ab7 !important;"
                                    rel="2">論文</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=App"
                                    title="App"
                                    style="color: #337ab7 !important;"
                                    rel="2">App</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=Bayesian"
                                    title="Bayesian"
                                    style="color: #337ab7 !important;"
                                    rel="2">Bayesian</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=Dynamic+Programming"
                                    title="Dynamic Programming"
                                    style="color: #337ab7 !important;"
                                    rel="2">Dynamic Programming</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=Keyboard"
                                    title="Keyboard"
                                    style="color: #337ab7 !important;"
                                    rel="2">Keyboard</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=Processing"
                                    title="Processing"
                                    style="color: #337ab7 !important;"
                                    rel="2">Processing</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=R"
                                    title="R"
                                    style="color: #337ab7 !important;"
                                    rel="2">R</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=Steam"
                                    title="Steam"
                                    style="color: #337ab7 !important;"
                                    rel="2">Steam</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=filesystem"
                                    title="filesystem"
                                    style="color: #337ab7 !important;"
                                    rel="2">filesystem</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=quarto"
                                    title="quarto"
                                    style="color: #337ab7 !important;"
                                    rel="2">quarto</a>
                        
                                <a data-sort="0347" 
                                    href="/archive/?tag=regex"
                                    title="regex"
                                    style="color: #337ab7 !important;"
                                    rel="2">regex</a>
                    </div>

                <br>

                <b><fontsize="5">Leave a Comment</font><br>(注意：GitHub Accountが必要となります）</b>
                
                <script src="https://utteranc.es/client.js"
                    repo="RyoNakagami/RyoNakagami.github.io"
                    issue-term="url"
                    theme="github-light"
                    crossorigin="anonymous"
                    async>Reduce unused JavaScript
                
                </script>


            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-1 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog fixed" style="margin-top:3%">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CONTENTS</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        
    <!-- Sidebar Container -->
            <!-- <div class="
                col-lg-10 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container row"> -->
                <!-- 
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="https://twitter.com/bluesky0804?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor">bluesky0804</a></li>
  
</ul>

 -->
            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->

  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true, // for pseudo
      tags: "ams",
      autoload: {
        color: [],
        colorV2: ['color']
      },
      packages: {'[+]': ['noerrors']}
    },
    chtml: {
      matchFontHeight: false,
      displayAlign: "left",
      displayIndent: "2em"
    },
    options: {
      renderActions: {
        /* add a new named action to render <script type="math/tex"> */
        find_script_mathtex: [10, function (doc) {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/);
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
            const text = document.createTextNode('');
            node.parentNode.replaceChild(text, node);
            math.start = {node: text, delim: '', n: 0};
            math.end = {node: text, delim: '', n: 0};
            doc.math.push(math);
          }
        }, '']
      }
    },
    loader: {
      load: ['[tex]/noerrors']
    }
  };
</script>





<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>


<body>
    <!-- enable mermaid language on markdown post -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
<script>
   mermaid.initialize({
       startOnLoad:true,
       theme: 'default'
   });
   window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
</script>

</body>

    <script>
    
    var elements = document.querySelectorAll('p');
    Array.prototype.forEach.call(elements, function(el, i){
        if(el.innerHTML=='[expand]') {
            var parentcontent = el.parentNode.innerHTML.replace('<p>[expand]</p>','<div class="expand" style="display: none; height: 0; overflow: hidden;">').replace('<p>[/expand]</p>','</div>');
            el.parentNode.innerHTML = parentcontent;
        }
    });

    var elements = document.querySelectorAll('div.expand');
    Array.prototype.forEach.call(elements, function(el, i){
        el.previousElementSibling.innerHTML = el.previousElementSibling.innerHTML + '<span>..&nbsp; <a href="#" style="cursor: pointer;" onclick="this.parentNode.parentNode.nextElementSibling.style.display = \'block\'; this.parentNode.parentNode.nextElementSibling.style.height = \'auto\'; this.parentNode.style.display = \'none\';">read&nbsp;more&nbsp;&rarr;</a></span>';
    });

</script>

    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <!--<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> -->
                <!-- SNS Link -->
            


<ul class="list-inline text-center">


  
  
  
  
  <li>
    <a target="_blank" href="https://github.com/RyoNakagami">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

            
            <p class="copyright text-muted">
                Copyright &copy; Ryo's Tech Blog 2025
                <br>
                Powered by <a href="https://ryonakagami.github.io">Ryo's Tech Blog</a> |
                <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="100px"
                    height="20px"
                    title="RyoNakagami.github.io github stars"
                    src="https://ghbtns.com/github-btn.html?user=RyoNakagami&repo=RyoNakagami.github.io&type=star&count=true">
                </iframe>
            </p>
            <!--</div> -->
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/ryo-blog.min.js "></script>

<!-- Simple Jekyll Search -->
<script src="/js/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LVL413SV09"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-LVL413SV09');
</script>



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog(selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason, 
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure 
                });
                $searchInput.focus();
            }
        });
    });
</script>



<!-- Image to Github 
<img src="/img/icon_wechat.png" width="0" height="0" />
<-- Migrate from head to bottom, no longer block render and still work -->
<script>
    
    var elements = document.querySelectorAll('p');
    Array.prototype.forEach.call(elements, function(el, i){
        if(el.innerHTML=='[expand]') {
            var parentcontent = el.parentNode.innerHTML.replace('<p>[expand]</p>','<div class="expand" style="display: none; height: 0; overflow: hidden;">').replace('<p>[/expand]</p>','</div>');
            el.parentNode.innerHTML = parentcontent;
        }
    });

    var elements = document.querySelectorAll('div.expand');
    Array.prototype.forEach.call(elements, function(el, i){
        el.previousElementSibling.innerHTML = el.previousElementSibling.innerHTML + '<span>..&nbsp; <a href="#" style="cursor: pointer;" onclick="this.parentNode.parentNode.nextElementSibling.style.display = \'block\'; this.parentNode.parentNode.nextElementSibling.style.height = \'auto\'; this.parentNode.style.display = \'none\';">read&nbsp;more&nbsp;&rarr;</a></span>';
    });

</script>

</body>
</html>
